<!DOCTYPE html>
<html lang="en">
<head>
    <title>Calculator</title>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/js/bootstrap.min.js" integrity="sha384-vZ2WRJMwsjRMW/8U7i6PWi6AlO1L79snBrmgiDpgIWJ82z8eA5lenwvxbMV1PAh7" crossorigin="anonymous"></script>

    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">-->
    <script src="assets/values/ships.js" ></script>
    <script src="assets/values/blueprints.js" ></script>
    <script src="assets/values/components.js" ></script>
    <link rel="stylesheet" href="css/bootstrap-glyphicons.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/engineer-profile.css">
    <link rel="stylesheet" href="css/calculator.css">
    <link rel="stylesheet" href="css/components-extension.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div id="header"><h1>CALCULATOR</h1><img class="image" src="assets/drawables/engineer-header.png"/></div>
    </div>
    <div id="menu-buttons" class="row">
        <div class="col-lg-12">
            <button id="page-1" class="flat-butt" onclick="switchPage(this)">Calculator</button>
            <button id="page-2" class="flat-butt" onclick="switchPage(this)">Blueprints</button>
            <button id="page-3" class="flat-butt" onclick="switchPage(this)">Inventory</button>
            <button id="page-4" class="flat-butt" onclick="switchPage(this)">Page 4</button>
            <button id="page-5" class="flat-butt" onclick="switchPage(this)">Page 5</button>
        </div>
    </div>
    <div id="div-page-1" class="row large-top-buffer">
        <div id="content-left" class="col-lg-5">
            <div class="row">
                <div class="col-lg-5 orange-header white panel"><h6>SHIP PROFILE</h6></div>
                <div class="col-lg-5 col-lg-offset-1 orange-header white panel"><h6>MODULE UPGRADE</h6></div>
            </div>
            <div class="row small-top-buffer">
                <div class="col-lg-5 no-padding">
                    <button class="btn-block flat-butt" type="button" data-toggle="modal" data-target="#selectShipModal" onclick="addStoredShips()">Select ship</button>
                </div>
                <div class="col-lg-5 col-lg-offset-1"></div>
            </div>
            <div class="row small-top-buffer">
                <div id="ship-profile" class="col-lg-5">
                </div>
                <div id="module-upgrade" class="col-lg-5 col-lg-offset-1">
                    <p id='fsd-increased-fsd-range-5' onclick='applyEffect(this)'>FSD G5</p>
                    <p>Stuff</p>
                    <p>Stuff</p>
                    <p>Stuff</p>
                    <p>Stuff</p>
                </div>
            </div>
        </div>
        <div id="content-right" class="col-lg-7">
            <table class="table table-sm table-hover table-inverse">
                <thead>
                <tr>
                    <th>Ship Stats</th>
                    <th>Base Value</th>
                    <th>Roll Min</th>
                    <th>Roll Avg</th>
                    <th>Roll Max</th>
                </tr>
                </thead>
                <tbody id="stats">
                <td>Select a ship...</td>
                </tbody>
            </table>
        </div>
    </div>
    <div id="div-page-2" class="row large-top-buffer removed">
        <div id="content-left-2" class="col-lg-5">
            <div class="row">
                <div class="orange-header white panel"><h6>AVAILABLE BLUEPRINTS</h6></div>
                <div id="available-blueprints"></div>
            </div>
        </div>
        <div id="content-right-2" class="col-lg-7">
            <div class="orange-header white panel" onclick="resetBlueprints()"><h6>CHOSEN BLUEPRINTS</h6></div>
            <div id="chosen-blueprints">
                <div id="blueprint-amounts">
                </div>
            </div>
        </div>
    </div>
    <div id="div-page-3" class="row large-top-buffer removed">
        <div data-reactroot="">
            <div class="container-fluid">
                <div class="row">
                    <div id="content-column">
                        <div class="row">
                            <div class="col-md-12">
                                <table id="component-table" class="table">
                                    <thead>
                                    <tr>
                                        <th>Personal stock</th>
                                        <th>Component</th>
                                        <th>Type</th>
                                        <th>Subtype</th>
                                        <th>Rarity</th>
                                        <th>Location</th>
                                        <th>Mission reward</th>
                                    </tr>
                                    </thead>
                                    <tbody id="components-body">
                                    </tbody>
                                </table>
                                <div>
                                    <p>Total number of components: <span id="components-total"></span></p>
                                    <p>Total number of materials: <span id="materials-total"></span></p>
                                    <p>Total number of elements: <span id="elements-total"></span></p>
                                    <p>Total number of data: <span id="data-total"></span></p>
                                    <p>Total number of commodities: <span id="commodities-total"></span></p>
                                    <p>Total number of components you are missing: <span id="components-missing"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="div-page-4" class="row large-top-buffer removed">
        <div id="content-left-4" class="col-lg-5">
            <p>Page 4</p>
        </div>
        <div id="content-right-4" class="col-lg-7">
            <p>Page 4</p>
        </div>
    </div>
    <div id="div-page-5" class="row large-top-buffer removed">
        <div id="content-left-5" class="col-lg-5">
            <p>Page 5</p>
        </div>
        <div id="content-right-5" class="col-lg-7">
            <p>Page 5</p>
        </div>
    </div>

    <div class="modal fade" id="selectShipModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content modal-background">
                <div class="modal-header orange-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="selectShipModalLabel">Select ship</h4>
                </div>
                <div class="modal-body">
                    <div class="list-wrapper overflowed">
                        <div id="stored-ships" class="list-group">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-block flat-butt" data-toggle="modal" data-target="#addShipModal">Add new ship</button>
                    <button type="button" class="btn-block flat-butt" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addShipModal" tabindex="-1" role="dialog" aria-labelledby="addShipModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content modal-background">
                <div class="modal-header orange-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="addShipModalLabel">Add new ship</h4>
                </div>
                <div class="modal-body">
                    <div class="list-wrapper overflowed">
                        <form>
                            <fieldset class="form-group">
                                <label for="add-ship-json">Paste your <a href="http://coriolis.io">coriolis.io</a> ship profile here</label>
                                <textarea class="form-control" id="add-ship-json" rows="6"></textarea>
                            </fieldset>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-block flat-butt" onclick="addAndStoreShip()">Add ship</button>
                    <button type="button" class="btn-block flat-butt" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var storedAvailableBlueprints;
    var storedChosenBlueprints;

    //addBlueprints();

    addAvailableBluePrints();
    addChosenBlueprints();

    generateComponentsList();
    updateTotals();
    addStoredShips();
    //addStoredRecipes();


    function deleteShip(element) {

        if (event.stopPropagation) {
            // W3C standard variant
            event.stopPropagation()
        } else {
            // IE variant
            event.cancelBubble = true
        }

        var shipId = element.parentElement.parentElement.id;
        var storedShips = getStoredShips();
        storedShips.ships.splice(shipId, 1);
        localStorage.setItem('stored-ed-ships', JSON.stringify(storedShips));
        addStoredShips();
    }

    function addAndStoreShip() {
        var jsonStr = document.getElementById('add-ship-json').value;
        if(jsonStr != null) {
            var obj = JSON.parse(jsonStr);
            var storedShips = JSON.parse(localStorage.getItem('stored-ed-ships'));
            if(storedShips == null) {
                storedShips = JSON.parse('{"ships":[]}');
            }
            storedShips.ships.push(obj);
            localStorage.setItem('stored-ed-ships', JSON.stringify(storedShips));
            document.getElementById('add-ship-json').value = '';
            addStoredShips();
            $("#addShipModal").modal('hide');
        }
    }

    function addStoredShips() {
        var storedShips = getStoredShips();
        var storedShipsList = document.getElementById('stored-ships');
        //console.log(storedShips);
        while(storedShipsList.firstChild) {
            storedShipsList.removeChild(storedShipsList.firstChild);
        }
        if(storedShips != null) {
            for (var i = 0; i < storedShips.ships.length; i++) {

                var shipRow = document.createElement('a');
                shipRow.href = '#';
                shipRow.id = i;
                shipRow.classList = 'list-group-item list-group-item-inverted';
                shipRow.onclick = function () {
                    selectShip(this);
                };
                var shipRowContents = document.createTextNode(storedShips.ships[i].name + ' (' + storedShips.ships[i].ship + ')');
                var deleteButton = document.createElement('button');
                deleteButton.classList = 'flat-butt pull-md-right';
                deleteButton.zIndex = 500000;
                deleteButton.onclick = function () {
                    deleteShip(this);
                };
                var deleteIcon = document.createElement('span');
                deleteIcon.classList = 'glyphicon glyphicon-remove';
                deleteIcon.onclick = function () {
                    deleteShip(this);
                };
                deleteButton.appendChild(deleteIcon);
                shipRow.appendChild(deleteButton);
                shipRow.appendChild(shipRowContents);
                storedShipsList.appendChild(shipRow);
            }
        }
    }

    function getStoredAvailableBlueprints() {
        return JSON.parse(localStorage.getItem('available-blueprints'));
    }

    function setStoredAvailableBlueprints(blueprints) {
        localStorage.setItem('available-blueprints', JSON.stringify(blueprints));
    }

    function getStoredChosenBlueprints() {
        return JSON.parse(localStorage.getItem('chosen-blueprints'));
    }

    function setStoredChosenBlueprints(blueprints) {
        localStorage.setItem('chosen-blueprints', JSON.stringify(blueprints));
    }

    function resetBlueprints() {
        localStorage.clear('available-blueprints');
        var chosenBlueprintsElement = document.getElementById('blueprint-amounts');
        while(chosenBlueprintsElement.firstChild) {
            chosenBlueprintsElement.removeChild(chosenBlueprintsElement.firstChild);
        }
        addAvailableBluePrints();
    }

    function addAvailableBluePrints() {
        var blueprints;
        if(getStoredAvailableBlueprints() !== null) {
            blueprints = storedAvailableBlueprints = getStoredAvailableBlueprints();
        } else {
            blueprints = storedAvailableBlueprints = getBlueprints();
        }

        //var blueprints = getBlueprints();
        //console.log(blueprints);
        //console.log(Object.keys(blueprints).length);
        var availableBlueprints = document.getElementById('available-blueprints');
        var blueprintAmounts = document.getElementById('blueprint-amounts');

        while(availableBlueprints.firstChild){
            availableBlueprints.removeChild(availableBlueprints.firstChild);
        }

        var blueprintsKeys = Object.keys(blueprints);
        blueprintsKeys.sort();
        //console.log(blueprintsKeys);
        for(var i = 0; i < blueprintsKeys.length; i++) {
            //console.log(blueprintsKeys[i]);
            if(blueprints.hasOwnProperty(blueprintsKeys[i])) {
                //console.log(blueprints[blueprintsKeys[i]]);
                var blueprintName = blueprints[blueprintsKeys[i]].name;
                var blueprintModuleName = blueprints[blueprintsKeys[i]].module;
                var counter = 1;
                for(var ii = 1; ii < 6; ii++) {
                    var value = JSON.stringify(blueprints[blueprintsKeys[i]].recipes[ii.toString()]);
                    if(blueprints[blueprintsKeys[i]].recipes.hasOwnProperty(ii.toString())) {
                        var pElement = document.createElement('p');

                        var recipeRowElement = document.createElement('div');
                        recipeRowElement.classList = 'row recipeRowElement small-top-padding';
                        var recipeRowTitleElement = document.createElement('div');
                        recipeRowTitleElement.classList = 'col-md-10';
                        var recipeRowTitleText = document.createTextNode(blueprintsKeys[i]+ ' (' +ii+ ')');
                        recipeRowTitleElement.appendChild(recipeRowTitleText);
                        var recipeComponentRowElement = document.createElement('div');
                        recipeComponentRowElement.classList = 'row recipeComponentRowElement';
                        var recipeComponentElement = document.createElement('div');
                        var recipeComponentsRowElement = document.createElement('div');
                        recipeComponentsRowElement.classList = 'row recipeComponentsRowElement';
                        recipeComponentElement.classList = 'col-md-11 col-lg-offset-1';

                        pElement.id = blueprintsKeys[i]+ '-' +ii;
                        pElement.onclick = function () {addBlueprint(this);};

                        var textElement = document.createTextNode(blueprintModuleName);
                        pElement.appendChild(textElement);
                        textElement = document.createTextNode(' - ' +blueprintName+ ' ');
                        pElement.appendChild(textElement);
                        var brElement = document.createElement('br');
                        pElement.appendChild(brElement);
                        getGlyphNuts(pElement, ii);
                        //textElement = document.createTextNode(' (' +ii+ ')');
                        //pElement.appendChild(textElement);
                        availableBlueprints.appendChild(pElement);
                        counter++;
                    }
                }
            }
        }
    };

    function addChosenBlueprints() {
        var allBlueprints = getBlueprints();
        var blueprints;
        var chosenBlueprints = getStoredChosenBlueprints();
        if(getStoredChosenBlueprints() !== null) {
            var blueprintAmounts = document.getElementById('blueprint-amounts');

            while(blueprintAmounts.firstChild){
                blueprintAmounts.removeChild(blueprintAmounts.firstChild);
            }
            storedChosenBlueprints = blueprints = getStoredChosenBlueprints();
            var blueprintsKeys = Object.keys(blueprints);
            if(storedChosenBlueprints === undefined) {
                return;
            }

            for(var i = 0; i < Object.keys(blueprints).length; i++) {
                var blueprint = blueprints[blueprintsKeys[i]];
                if(blueprint === undefined) {
                    continue;
                }
                //console.log(blueprint);
                var blueprintId = blueprintsKeys[i].toString();
                var blueprintModuleName = blueprint.module;
                var recipeRowElement = document.createElement('div');
                recipeRowElement.onclick = function () {
                    removeBlueprint(this)
                };
                recipeRowElement.classList = 'row recipeRowElement small-top-padding';
                var recipeRowTitleElement = document.createElement('div');
                recipeRowTitleElement.classList = 'col-md-10';
                for(var ii = 1; ii < 6; ii++) {
                    var grade = blueprint.recipes[ii.toString()];
                    if(grade === undefined) {
                        continue;
                    }

                    var text = allBlueprints[blueprintId].name;
                    var recipeRowTitleText = document.createTextNode(text);
                    recipeRowTitleElement.appendChild(recipeRowTitleText);
                    getGlyphNuts(recipeRowTitleElement, ii);
                    var recipeComponentRowElement = document.createElement('div');
                    recipeComponentRowElement.classList = 'row recipeComponentRowElement';
                    var recipeComponentElement = document.createElement('div');
                    var recipeComponentsRowElement = document.createElement('div');
                    recipeComponentsRowElement.classList = 'row recipeComponentsRowElement';
                    recipeComponentElement.classList = 'col-md-11 col-lg-offset-1';
                    recipeRowElement.appendChild(recipeRowTitleElement);
                    for (var component in blueprint.recipes[ii.toString()].components) {
                        if (blueprint.recipes[ii.toString()].components.hasOwnProperty(component)) {
                            text = component.split('-');

                            var newText = '';
                            for(var iii = 0; iii < text.length; iii++) {
                                if(iii == 0) {
                                    newText += text[iii].charAt(0).toUpperCase() + text[iii].slice(1);
                                } else {
                                    newText += ' ' +text[iii].charAt(0).toUpperCase() + text[iii].slice(1);
                                }
                            }
                            var componentTextLeftElement = document.createElement('div');
                            componentTextLeftElement.classList = 'component-' + grade + ' col-lg-11';
                            var componentTextRightElement = document.createElement('div');
                            componentTextRightElement.classList = 'component-' + i + '-inventory';
                            var componentTextRight = getColouredText(blueprint.recipes[ii.toString()].components[component], getStoredValue(component));
                            componentTextRightElement.appendChild(componentTextRight);
                            var componentTextLeftNode = document.createTextNode(newText + ' (' + blueprint.recipes[ii.toString()].components[component] + ')');
                            componentTextLeftElement.appendChild(componentTextLeftNode);

                            recipeComponentsRowElement.appendChild(componentTextLeftElement);
                            recipeComponentsRowElement.appendChild(componentTextRightElement);
                        }
                    }
                }
                recipeComponentElement.appendChild(recipeComponentsRowElement);
                recipeComponentRowElement.appendChild(recipeComponentElement);
                recipeRowElement.appendChild(recipeComponentRowElement);
                blueprintAmounts.appendChild(recipeRowElement);
            }
            //delete storedAvailableBlueprints[blueprintId].recipes[grade.toString()];
            //setStoredAvailableBlueprints(storedAvailableBlueprints);
            //addAvailableBluePrints();
        }
    }

    function addBlueprint(element) {
        var allBlueprints = BLUEPRINTS;
        var blueprints = storedAvailableBlueprints;
        var blueprintId = element.id;
        var split = blueprintId.split('-');
        blueprintId = split.slice(0, split.length - 1).join('-');
        var grade = split[split.length-1];
        var blueprintAmounts = document.getElementById('blueprint-amounts');
        var blueprintsKeys = Object.keys(blueprints);
        blueprintsKeys.sort();

        var blueprint;
        if(blueprints.hasOwnProperty(blueprintId)) {
            blueprint = blueprints[blueprintId];
        }
        if(blueprint.recipes[grade] !== null) {
            var blueprintModuleName = blueprint.module;
            var recipeRowElement = document.createElement('div');
            recipeRowElement.id = 'chosen-' +blueprintId+ '-' +grade;
            recipeRowElement.onclick = function() {removeBlueprint(this)};
            recipeRowElement.classList = 'row recipeRowElement small-top-padding';
            var recipeRowTitleElement = document.createElement('div');
            recipeRowTitleElement.classList = 'col-md-10';
            
            var text = allBlueprints[blueprintId].name;
            var recipeRowTitleText = document.createTextNode(text);
            recipeRowTitleElement.appendChild(recipeRowTitleText);
            getGlyphNuts(recipeRowTitleElement, grade);

            var recipeComponentRowElement = document.createElement('div');
            recipeComponentRowElement.classList = 'row recipeComponentRowElement';
            var recipeComponentElement = document.createElement('div');
            var recipeComponentsRowElement = document.createElement('div');
            recipeComponentsRowElement.classList = 'row recipeComponentsRowElement';
            recipeComponentElement.classList = 'col-md-11 col-lg-offset-1';
            recipeRowElement.appendChild(recipeRowTitleElement);
            for(var component in blueprint.recipes[grade.toString()].components) {
                if(blueprint.recipes[grade.toString()].components.hasOwnProperty(component)) {
                    text = component.split('-');

                    var newText = '';
                    for(var iii = 0; iii < text.length; iii++) {
                        if(iii == 0) {
                            newText += text[iii].charAt(0).toUpperCase() + text[iii].slice(1);
                        } else {
                            newText += ' ' +text[iii].charAt(0).toUpperCase() + text[iii].slice(1);
                        }
                    }
                    var componentTextLeftElement = document.createElement('div');
                    componentTextLeftElement.classList = 'component-' +grade+ ' col-lg-11';
                    var componentTextRightElement = document.createElement('div');
                    componentTextRightElement.classList = 'component-' +grade+ '-inventory';
                    var componentTextRight = getColouredText(blueprint.recipes[grade.toString()].components[component], getStoredValue(component));
                    componentTextRightElement.appendChild(componentTextRight);
                    var componentTextLeftNode = document.createTextNode(newText + ' (' +blueprint.recipes[grade.toString()].components[component]+ ')');
                    componentTextLeftElement.appendChild(componentTextLeftNode);

                    recipeComponentsRowElement.appendChild(componentTextLeftElement);
                    recipeComponentsRowElement.appendChild(componentTextRightElement);
                }
            }
            recipeComponentElement.appendChild(recipeComponentsRowElement);
            recipeComponentRowElement.appendChild(recipeComponentElement);
            recipeRowElement.appendChild(recipeComponentRowElement);
            blueprintAmounts.appendChild(recipeRowElement);

        }
        var chosenBlueprint = storedAvailableBlueprints[blueprintId];
        if(getStoredChosenBlueprints() === null) {
            storedChosenBlueprints = {};
        }
        var chosenGrade = JSON.parse(grade.toString());
        var chosenRecipe = JSON.parse(JSON.stringify(allBlueprints[blueprintId.toString()].recipes[grade.toString()]));
        storedChosenBlueprints[blueprintId] = {};
        storedChosenBlueprints[blueprintId]['recipes'] = {};
        storedChosenBlueprints[blueprintId]['recipes'][chosenGrade] = {};
        storedChosenBlueprints[blueprintId]['recipes'][chosenGrade] = chosenRecipe;
        delete storedAvailableBlueprints[blueprintId].recipes[grade.toString()];
        setStoredChosenBlueprints(storedChosenBlueprints);
        setStoredAvailableBlueprints(storedAvailableBlueprints);
        addAvailableBluePrints();
    }

    function removeBlueprint(element) {
        var blueprintId = element.id;
        var split = blueprintId.split('-');
        blueprintId = split.slice(0, split.length - 1).join('-');
        var grade = split[split.length-1];
        delete storedChosenBlueprints[blueprintId].recipes[grade.toString()];
        element.remove();
    }

    function getColouredText(requirement, inventory) {
        var spanElement = document.createElement('span');
        var spanElementText = document.createTextNode(inventory);
        spanElement.appendChild(spanElementText);
        if(inventory < requirement) {
            spanElement.classList = 'red';
        } else if(inventory > requirement) {
            spanElement.classList = 'blue';
        }
        return spanElement;
    }

    function switchPage(element) {
        for (var i = 1; i < 6; i++) {
            var page = document.getElementById('div-page-' + i);
            if (i == element.id.substr(5)) {
                page.className = page.className.replace(/(?:^|\s)removed(?!\S)/g, '');
            } else {
                page.className += " removed";
            }
        }
    }

    function selectShip(element) {
        getShipOutfitting(element.id);
        $("#selectShipModal").modal('hide');
    }

    function getStoredShips() {
        var storedShips = JSON.parse(localStorage.getItem('stored-ed-ships'));
        //console.log(storedShips);
        return storedShips;
    }

    function getBlueprints() {

        //var storedShips = JSON.parse(RECIPES);
        //console.log(storedShips);
        return BLUEPRINTS;
    }

    function getStoredShipsArray() {
        var storedShips = JSON.parse(localStorage.getItem('stored-ed-ships'));
        //console.log(storedShips);
        var ships = new Array();
        for(var i = 0; i < storedShips.ships.length; i++) {
            ships.push(storedShips.ships[i].name.replace(/ /g, '-').toLowerCase());
        }
        return ships;
    }

    function getShipOutfitting(shipId) {
        var storedShips = getStoredShips();
        var outfittingList = document.getElementById('ship-profile');
        while(outfittingList.firstChild) {
            outfittingList.removeChild(outfittingList.firstChild);
        }
        var p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.bulkheads));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode('Cargo Hatch'));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.powerPlant.rating + '' + storedShips.ships[shipId].components.standard.powerPlant.class + ' Power plant'));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.thrusters.rating+''+storedShips.ships[shipId].components.standard.thrusters.class+' Thrusters'));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.frameShiftDrive.rating + '' + storedShips.ships[shipId].components.standard.frameShiftDrive.class + ' Frame Shift Drive'));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.lifeSupport.rating + '' + storedShips.ships[shipId].components.standard.lifeSupport.class + ' Life support'));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.powerDistributor.rating + '' + storedShips.ships[shipId].components.standard.powerDistributor.class + ' Power distributor'));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.sensors.rating + '' + storedShips.ships[shipId].components.standard.sensors.class + ' Sensors'));
        outfittingList.appendChild(p);
        p = document.createElement('p');
        p.appendChild(document.createTextNode(storedShips.ships[shipId].components.standard.fuelTank.rating + '' + storedShips.ships[shipId].components.standard.fuelTank.class + ' Fuel tank'));
        outfittingList.appendChild(p);
        var hr = document.createElement('hr');
        outfittingList.appendChild(hr);
        for(var i = 0; i < storedShips.ships[shipId].components.hardpoints.length; i++) {
            if(storedShips.ships[shipId].components.hardpoints[i] != null) {
                p = document.createElement('p');
                p.appendChild(document.createTextNode(storedShips.ships[shipId].components.hardpoints[i].rating + '' + storedShips.ships[shipId].components.hardpoints[i].class + ' ' + storedShips.ships[shipId].components.hardpoints[i].group));
                outfittingList.appendChild(p);
            }
        }
        hr = document.createElement('hr');
        outfittingList.appendChild(hr);
        for(var i = 0; i < storedShips.ships[shipId].components.utility.length; i++) {
            if(storedShips.ships[shipId].components.utility[i] != null) {
                p = document.createElement('p');
                p.appendChild(document.createTextNode(storedShips.ships[shipId].components.utility[i].rating + '' + storedShips.ships[shipId].components.utility[i].class + ' ' + storedShips.ships[shipId].components.utility[i].group));
                outfittingList.appendChild(p);
            }
        }
        hr = document.createElement('hr');
        outfittingList.appendChild(hr);
        for(var i = 0; i < storedShips.ships[shipId].components.internal.length; i++) {
            if(storedShips.ships[shipId].components.internal[i] != null) {
                p = document.createElement('p');
                p.appendChild(document.createTextNode(storedShips.ships[shipId].components.internal[i].rating + '' + storedShips.ships[shipId].components.internal[i].class + ' ' + storedShips.ships[shipId].components.internal[i].group));
                outfittingList.appendChild(p);
            }
        }

        addShipStats(storedShips, shipId);
    }

    function applyEffect(element) {
        var allBlueprints = BLUEPRINTS;
        var split = element.id.split("-");
        var blueprint = split.slice(0, split.length - 1).join("-");
        var grade = element.id.split(/[-]+/).pop();


        if(blueprint !== null) {
            var chosenRecipe = JSON.parse(JSON.stringify(allBlueprints[blueprint.toString()].recipes[grade.toString()]));
        }
    }

    function addShipStats(storedShips, shipId) {
        removeChildren('stats');
        addStatsRow('Base Armour', storedShips.ships[shipId].stats.baseArmour.toString());
        addStatsRow('Armour', storedShips.ships[shipId].stats.armour.toString());
        addStatsRow('Base Shield Strength', storedShips.ships[shipId].stats.baseShieldStrength.toString());
        addStatsRow('Shield Strength', storedShips.ships[shipId].stats.shieldStrength.toString());
        addStatsRow('Hull Mass', storedShips.ships[shipId].stats.hullMass.toString());
        addStatsRow('Unladen Mass', storedShips.ships[shipId].stats.unladenMass.toString());
        addStatsRow('Laden Mass', storedShips.ships[shipId].stats.ladenMass.toString());
        addStatsRow('Power Available', storedShips.ships[shipId].stats.powerAvailable.toString());
        addStatsRow('Power Retracted', storedShips.ships[shipId].stats.powerRetracted.toString());
        addStatsRow('Power Deployed', storedShips.ships[shipId].stats.powerDeployed.toString());
        addStatsRow('Unladen range', storedShips.ships[shipId].stats.unladenRange.toString());
        addStatsRow('Full Tank Range', storedShips.ships[shipId].stats.fullTankRange.toString());
        addStatsRow('Laden range', storedShips.ships[shipId].stats.ladenRange.toString());
        addStatsRow('Speed', storedShips.ships[shipId].stats.speed.toString());
        addStatsRow('Boost', storedShips.ships[shipId].stats.boost.toString());
        addStatsRow('Top Speed', storedShips.ships[shipId].stats.topSpeed.toString());
        addStatsRow('Top Boost', storedShips.ships[shipId].stats.topBoost.toString());
    }

    function addStatsRow(stat, value) {
        var statsElement = document.getElementById('stats');

        var textElement = document.createTextNode(stat);
        var trElement = document.createElement('tr');
        var tdElement = document.createElement('td');
        tdElement.classList = 'no-top-border';
        tdElement.appendChild(textElement);
        trElement.appendChild(tdElement);

        tdElement = document.createElement('td');
        tdElement.classList = '';
        textElement = document.createTextNode(value);
        tdElement.appendChild(textElement);
        trElement.appendChild(tdElement);

        tdElement = document.createElement('td');
        tdElement.classList = 'red';
        textElement = document.createTextNode('--');
        tdElement.appendChild(textElement);
        trElement.appendChild(tdElement);

        tdElement = document.createElement('td');
        textElement = document.createTextNode('--');
        tdElement.appendChild(textElement);
        trElement.appendChild(tdElement);
        tdElement.classList = 'blue';

        tdElement = document.createElement('td');
        textElement = document.createTextNode('--');
        tdElement.appendChild(textElement);
        trElement.appendChild(tdElement);
        statsElement.appendChild(trElement);
    }

    function removeChildren(parentId) {
        var parent = document.getElementById(parentId);
        while(parent.firstChild) {
            parent.removeChild(parent.firstChild);
        }
    }

    function getNiceStringFromModule(module) {
        switch(module) {
            case 'frameShiftDrive':
                return 'Frame Shift Drive';
                break;
            default:
                return 'sag a* knows';
                break;
        }
    }

    function generateComponentsList() {
        var tBody = document.getElementById('components-body');
        var nrOfComponents = Object.keys(DATA).length;
        for(var i = 0; i < nrOfComponents; i++) {
            var tr = document.createElement('tr');
            var td = document.createElement('td');
            var key = Object.keys(DATA)[i];
            var p = document.createElement('p');
            var buttonMinus = document.createElement('button');
            var input = document.createElement('input');
            var buttonPlus = document.createElement('button');
            p.className = 'component-p';
            p.innerHTML = DATA[key].name;
            td.appendChild(p);
            buttonMinus.id = 'button-minus-one-'+key;
            buttonMinus.className = 'flat-butt btn-xlarge half-width';
            buttonMinus.onclick = function () {minus(this);};
            buttonMinus.field = key;
            buttonMinus.innerHTML = '-';
            td.appendChild(buttonMinus);
            input.id = key;
            input.name = key;
            input.onkeyup = function() { storeValue(this)};
            input.onchange = function() { storeValue(this)};
            input.className = 'form-control form-orange';
            input.type = 'number';
            input.value = getStoredValue(key);
            input.min = '0';
            td.appendChild(input);
            buttonPlus.id = 'button-plus-one-'+key;
            buttonPlus.className = 'flat-butt btn-xlarge half-width';
            buttonPlus.onclick = function() {plus(this);};
            buttonPlus.field = key;
            buttonPlus.innerHTML = '+';
            td.appendChild(buttonPlus);
            tr.appendChild(td);
            td = document.createElement('td');
            td.className = 'component-td';
            td.innerHTML = DATA[key].name;
            tr.appendChild(td);
            td = document.createElement('td');
            td.innerHTML = DATA[key].type;
            tr.appendChild(td);
            td = document.createElement('td');
            td.innerHTML = DATA[key].subtype;
            tr.appendChild(td);
            td = document.createElement('td');
            td.innerHTML = getGlyphRarities(DATA[key].rarity);
            tr.appendChild(td);
            td = document.createElement('td');
            td.innerHTML = DATA[key].location;
            tr.appendChild(td);
            td = document.createElement('td');
            td.innerHTML = DATA[key].missionReward;
            tr.appendChild(td);
            tBody.appendChild(tr);
        }
    }

    function getStoredValue(id) {
        var value = localStorage.getItem(id);
        if(isNumeric(value)) {
            return value;
        }
        return 0;
    }

    function plus(element) {
        var storageField = element.previousSibling;
        var storageFieldValue = storageField.value;
        if(isNumeric(storageFieldValue)) {
            storageField.value++;
            localStorage.setItem(storageField.name, storageField.value);
        } else {
            storageField.value = 1;
        }
    }

    function minus(element) {
        var storageField = element.nextSibling;
        var storageFieldValue = storageField.value;
        if(isNumeric(storageFieldValue)) {
            if(storageFieldValue < 1) {
                storageField.value = 0;
            } else {
                storageField.value--;
                localStorage.setItem(storageField.name, storageField.value);
            }
        } else {
            storageField.value = 0;
        }
    }

    function isNumeric(n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
    }

    function storeValue(element) {
        var storageFieldValue = element.value;
        if(isNumeric(storageFieldValue)) {
            localStorage.setItem(element.name, element.value);
        } else {
            element.value = 0;
        }
    }

    function updateTotals() {
        var nrOfComponents = Object.keys(DATA).length;
        var totalNrOfComponents = 0;
        var totalNrOfMaterials = 0;
        var totalNrOfElements = 0;
        var totalNrOfData = 0;
        var totalNrOfCommodities = 0;
        var totalNrOfMissingComponents = 0;
        for(var i = 0; i < nrOfComponents; i++) {
            var tr = document.createElement('tr');
            var td = document.createElement('td');
            var key = Object.keys(DATA)[i];
            if(isNumeric(localStorage.getItem(key))) {
                totalNrOfComponents += parseInt(localStorage.getItem(key));
                if(DATA[key].type == 'Man') {
                    totalNrOfMaterials += parseInt(localStorage.getItem(key));
                } else if(DATA[key].type == 'Ele') {
                    totalNrOfElements += parseInt(localStorage.getItem(key));
                } else if(DATA[key].type == 'Data') {
                    totalNrOfData += parseInt(localStorage.getItem(key));
                } else if(DATA[key].type == 'Com') {
                    totalNrOfCommodities += parseInt(localStorage.getItem(key));
                }
            }
            if(parseInt(localStorage.getItem(key)) == 0 || localStorage.getItem(key) == null) {
                totalNrOfMissingComponents++;
            }
        }

        document.getElementById('components-total').innerHTML = ''+totalNrOfComponents;
        document.getElementById('materials-total').innerHTML = ''+totalNrOfMaterials;
        document.getElementById('elements-total').innerHTML = ''+totalNrOfElements;
        document.getElementById('data-total').innerHTML = ''+totalNrOfData;
        document.getElementById('commodities-total').innerHTML = ''+totalNrOfCommodities;
        document.getElementById('components-missing').innerHTML = ''+totalNrOfMissingComponents;
    }

    function getGlyphNuts(element, nutz) {
        for(var i = 0; i < nutz; i++) {
            var spanElement = document.createElement('span');
            spanElement.classList = 'glyph-nut';
            element.appendChild(spanElement);
        }
        //return glyphs;
    }

    function getGlyphRarities(number) {
        var spanElement = document.createElement('span');
        switch(number) {
            case 1:
                spanElement.className = 'rarity-leaf-1';
                break;
            case 2:
                spanElement.className = 'rarity-leaf-2';
                break;
            case 3:
                spanElement.className = 'rarity-leaf-3';
                break;
            case 4:
                spanElement.className = 'rarity-leaf-4';
                break;
            default:
                var spanElementText = document.createTextNode(number);
                spanElement.appendChild(spanElementText);
                break;
        }
        return spanElement.outerHTML;
    }

    /*
    function getStoredValue(id) {
        var value = localStorage.getItem(id);
        if(isNumeric(value)) {
            return value;
        }
        return 0;
    }

    function isNumeric(n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
    }
    */
    //$("#selectShipModal").modal('show');
    //$("#addShipModal").modal('show');
</script>
</body>
</html>